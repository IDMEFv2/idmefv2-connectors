# IDMEFv2 Clamav connector

This directory contains Python implementation of IDMEFv2 Clamav (https://www.clamav.net/) connector.

## Overview

The Clamav connector uses the Clamav JSON output format and the `metadata.json` file generated by `clamd` (see https://manpages.debian.org/testing/clamav-daemon/clamd.conf.5.en.html).

Upon completion of a scan by `clamdscan`, the generated `metadata.json` will be analyzed by the connector and the virus detection data will be converted to a IDMEFv2 alert that will be sent to a IDMEFv2 server (either the testserver or the Concerto SIEM).

## Configuration

The connector uses a INI configuration file; a specific part for Clamav provides the location of the temporary directory where `metadata.json` files will be located. An example of configuration file is given in [clamav-idmefv2.sample.conf](./clamav-idmefv2.sample.conf).

Example of Clamav connector configuration file:

``` ini
[logging]
# Logging level: change to DEBUG for more information, INFO for less information
level = DEBUG
# level = INFO

[idmefv2]
# URL of server to POST IDMEFv2 alerts
url = http://testserver.idmefv2:9999

[clamav]
# Location of clamav temp dir
tempdir=/var/tmp/clamav
```
### clamd configuration

In order for the connector to be able to track Clamav alerts using generated `metadata.json`, the following changes must be made to `clamd.conf`:

```
Debug true
LeaveTemporaryFiles true
GenerateMetadataJson true
TemporaryDirectory /var/tmp/clamav
```

## Running

The `idmefv2.connectors.clamav` Python module can be run directly. The only mandatory command line argument is the path of the configuration file.

``` sh
python3 -m idmefv2.connectors.clamav -c /etc/clamav-idmefv2.conf
```

Upon detection of a virus during a scan, the alert generated by Clamav will be converted to IDMEFv2 and uploaded to the test server or to Concerto SIEM.
